<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>DONSOCIAL</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="./styles.css" />

    <!-- Performance: adelanta conexión con el Pixel -->
    <link rel="preconnect" href="https://connect.facebook.net" crossorigin />
    <link rel="dns-prefetch" href="//connect.facebook.net" />

    <!-- Performance: precarga imagen de fondo del hero (cambiá el href si tu archivo es otro) -->
    <link rel="preload" as="image" href="imagenes/fondo.avif" type="image/avif" fetchpriority="high" />

    <!-- Meta Pixel Code (con coincidencias avanzadas manuales) -->
<script>
  // Utilidades
  function getQS(name){ const u=new URLSearchParams(location.search); return u.get(name)||null }
  function normEmail(v){ return (v||"").trim().toLowerCase() }
  function normPhone(v){
    // deja solo dígitos; si es AR agrega 54 si faltara
    let p=(v||"").replace(/\D+/g,"");
    if(p && p.length===10) p="54"+p; // opcional, ajustá a tu necesidad
    return p;
  }
  function getOrCreateExternalId(){
    const k="external_id";
    let id=localStorage.getItem(k);
    if(!id){
      id=(crypto && crypto.randomUUID) ? crypto.randomUUID() : (Date.now()+"-"+Math.random().toString(16).slice(2));
      localStorage.setItem(k,id);
    }
    return id;
  }

  // Datos de usuario disponibles (querystring o localStorage)
  const userEmail  = normEmail( getQS("em") || localStorage.getItem("em") || "" );
  const userPhone  = normPhone( getQS("ph") || localStorage.getItem("ph") || "" );
  const externalId = getOrCreateExternalId();

  !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
  n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
  n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
  t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window, document,'script',
  'https://connect.facebook.net/en_US/fbevents.js');

  fbq('init', '1459000075661483', {
    external_id: externalId,
    em: userEmail || undefined,
    ph: userPhone || undefined,
    country: 'AR'
  });

  fbq('track', 'PageView');
</script>
<noscript>
  <img height="1" width="1" style="display:none"
       src="https://www.facebook.com/tr?id=1459000075661483&ev=PageView&noscript=1"/>
</noscript>
<!-- End Meta Pixel Code -->
    
  </head>

  <body>
    <div class="container background-image">
      <div class="overlay"></div>
      <div class="content">
        <!-- Logo PNG -->
        <img src="imagenes/logo.png" class="logo" width="240" height="120"
             alt="DON SOCIAL" decoding="async" fetchpriority="high" />

        <p class="title">Envianos un WhatsApp<br />para crear tu cuenta</p>

        <a class="whatsapp-button" id="whatsappButton" href="#" rel="noopener noreferrer" aria-label="Crear usuario por WhatsApp">
          <span>¡Contactá ya!</span>
          <img src="imagenes/whatsapp.png" alt="whatsapp"
               class="whatsapp-icon" width="24" height="24" decoding="async" loading="lazy" />
        </a>

        <p class="subtitle">Sin Límite de retiro<br />Sin Cronogramas<br />Ganás y cobrás a cualquier hora</p>
        <p class="description">-RED OFICIAL: DON SOCIAL 32-</p>
      </div>
    </div>

    <script>
      const LANDING_PREFIX = "CH1.0";

      function getQueryParam(name) {
        const params = new URLSearchParams(window.location.search);
        const v = params.get(name);
        return v ? decodeURIComponent(v) : null;
      }

      function normalizeUtm(v) {
        return String(v || "").trim().replace(/\s+/g, "_").replace(/[^A-Za-z0-9_-]/g, "") || "ORG";
      }

      function generateUUID(){
        return crypto?.randomUUID?.() || "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,c=>{const r=Math.random()*16|0,v=c==="x"?r:r&0x3|0x8;return v.toString(16)});
      }

      (function persistUTM() {
        const utmFromUrl = getQueryParam("utm_campaign");
        if (utmFromUrl) localStorage.setItem("utm_campaign", utmFromUrl);
      })();

      function getUTMCampaign() {
        return getQueryParam("utm_campaign") || localStorage.getItem("utm_campaign") || "ORG";
      }

      document.getElementById("whatsappButton").addEventListener("click", function (e) {
        e.preventDefault();

        const numeros = ["5493516768842"];
        const telefono = numeros[Math.floor(Math.random() * numeros.length)];

        const utm = normalizeUtm(getUTMCampaign());
        const codigo = `${LANDING_PREFIX}-${utm}`;

        const variantes = [
          `¡Hola! Vi este anuncio, ¿me pasás info? ${codigo}`,
          `Hola! Vi el anuncio, ¿podés darme más info? ${codigo}`,
          `Buenas! Me contás un poco más del anuncio? ${codigo}`,
          `Hola! Quisiera saber más sobre lo que ofrecen. ${codigo}`,
          `Buenas! ¿Me das más detalles, por favor? ${codigo}`,
          `Hola! Estoy interesado, ¿cómo funciona? ${codigo}`,
          `Hola! Vi tu publicación, ¿podrías ampliarme la info? ${codigo}`,
          `Buenas! ¿Me podrías pasar información? ${codigo}`,
          `Hola! Estoy viendo el anuncio, ¿me das más datos? ${codigo}`,
          `Buenas! Me interesa, ¿podrías contarme más? ${codigo}`,
          `Hola! ¿Cómo hago para empezar? ${codigo}`,
          `Buenas! ¿Me compartís info para sumarme? ${codigo}`,
          `Hola! ¿Tenés más detalles del anuncio? ${codigo}`,
          `Buenas! Quiero más info, gracias. ${codigo}`,
          `Hola! Me interesa, ¿me explicás un poco? ${codigo}`,
          `Buenas! ¿Qué pasos tengo que seguir? ${codigo}`,
          `Hola! Vi el aviso, ¿me das info? ${codigo}`,
          `Buenas! Estoy interesado/a, ¿me pasás detalles? ${codigo}`,
          `Hola! ¿Me contás de qué se trata? ${codigo}`,
          `Buenas! Quiero saber más, ¿me ayudás? ${codigo}`
        ];

        const mensaje = variantes[Math.floor(Math.random() * variantes.length)];

        // ✅ Evento Contact enriquecido con eventID y datos de usuario
        const event_id = generateUUID();
        try {
          if (typeof fbq === "function") {
            fbq('track', 'Contact', {
              em: userEmail || undefined,
              ph: userPhone || undefined,
              external_id: externalId,
              content_name: 'CTA WhatsApp',
              content_category: 'LeadGen',
              utm_campaign: utm,
              code: codigo,
              source: 'main_button',
              method: 'Click'
            }, { eventID: event_id });
          }
        } catch(_){}

        // ✅ Redirect instantáneo (sin delay, sin pestaña nueva)
        window.location.assign(`https://wa.me/${telefono}?text=${encodeURIComponent(mensaje)}`);
      });
    </script>
  </body>
</html>
